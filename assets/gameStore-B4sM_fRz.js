import{y as m,u as a}from"./index-BvDZGiXJ.js";const g=m("game",{state:()=>({gameState:{gold:0,helpers:0,hasClue:!1,hasTreasure:!1,completedScenes:[],sceneCompleted:{}},logs:[]}),getters:{accessibleScenes(e){return[{id:"village",name:"Village"},{id:"library",name:"Library"},{id:"tavern",name:"Tavern"},{id:"temple",name:"Temple"},{id:"treasureRoom",name:"Treasure Room"},{id:"exit",name:"Exit"}].map(t=>({id:t.id,name:t.name,completed:e.gameState.completedScenes.includes(t.id)}))}},actions:{initGame(){const e=a(),s=localStorage.getItem(`gameState_${e.username}`);if(s){this.gameState=JSON.parse(s),this.gameState.sceneCompleted||(this.gameState.sceneCompleted={},(this.gameState.completedScenes||[]).forEach(t=>{this.gameState.sceneCompleted[t]=!0}));try{const t=localStorage.getItem(`gameLogs_${e.username}`);t&&!this.logs.length&&(this.logs=JSON.parse(t))}catch{}}else this.gameState={gold:50,helpers:1,hasClue:!1,hasTreasure:!1,completedScenes:[]},this.saveGame()},saveGame(){const e=a();localStorage.setItem(`gameState_${e.username}`,JSON.stringify(this.gameState));try{localStorage.setItem(`gameLogs_${e.username}`,JSON.stringify(this.logs||[]))}catch(s){console.error("保存日志失败",s)}},resetGame(){const e=a();localStorage.removeItem(`gameState_${e.username}`),localStorage.removeItem(`gameLogs_${e.username}`),this.initGame()},exploreVillage(){return this.gameState.sceneCompleted&&this.gameState.sceneCompleted.village?(this.logs.unshift({time:new Date().toLocaleString(),message:"你已经探索过村庄了。"}),this.saveGame(),{success:!1,message:"已探索"}):(this.gameState.sceneCompleted=this.gameState.sceneCompleted||{},this.gameState.sceneCompleted.village=!0,this.gameState.completedScenes.includes("village")||this.gameState.completedScenes.push("village"),this.gameState.gold=(this.gameState.gold||0)+10,this.logs.unshift({time:new Date().toLocaleString(),message:"你在村庄发现了一张破旧的地图并获得10金币！"}),this.saveGame(),{success:!0,message:"探索完成"})},exploreTemple(){return this.gameState.hasClue?(this.gameState.helpers||0)<1?(this.logs.unshift({time:new Date().toLocaleString(),message:"帮手不足，无法进入神庙。"}),this.saveGame(),{success:!1,message:"帮手不足"}):this.gameState.sceneCompleted&&this.gameState.sceneCompleted.temple?(this.logs.unshift({time:new Date().toLocaleString(),message:"你已探索过神庙。"}),this.saveGame(),{success:!1,message:"已探索"}):(this.gameState.helpers=Math.max(0,(this.gameState.helpers||0)-1),this.gameState.hasKey=!0,this.gameState.hasTreasure=!0,this.gameState.sceneCompleted=this.gameState.sceneCompleted||{},this.gameState.sceneCompleted.temple=!0,this.gameState.completedScenes.includes("temple")||this.gameState.completedScenes.push("temple"),this.logs.unshift({time:new Date().toLocaleString(),message:"你在神庙里找到了珍贵的宝藏！"}),this.saveGame(),{success:!0,message:"获得宝藏"}):(this.logs.unshift({time:new Date().toLocaleString(),message:"没有藏宝图，无法进入神庙。"}),this.saveGame(),{success:!1,message:"缺少线索"})},hireHelper(){return(this.gameState.gold||0)<20?(this.logs.unshift({time:new Date().toLocaleString(),message:"金币不足，无法雇佣帮手。",type:"warning"}),this.saveGame(),{success:!1,message:"金币不足"}):(this.gameState.gold=(this.gameState.gold||0)-20,this.gameState.helpers=(this.gameState.helpers||0)+1,this.logs.unshift({time:new Date().toLocaleString(),message:"雇佣了1名帮手，花费20金币。",type:"success"}),this.saveGame(),{success:!0,message:"雇佣成功"})},findTreasure(){return(this.gameState.helpers||0)<3?(this.logs.unshift({time:new Date().toLocaleString(),message:"帮手不足，无法安全获取宝藏。",type:"warning"}),this.saveGame(),{success:!1,message:"帮手不足"}):this.gameState.sceneCompleted&&this.gameState.sceneCompleted.treasureRoom?(this.logs.unshift({time:new Date().toLocaleString(),message:"宝藏已被找到。"}),this.saveGame(),{success:!1,message:"已找到"}):(this.gameState.helpers=Math.max(0,(this.gameState.helpers||0)-3),this.gameState.gold=(this.gameState.gold||0)+30,this.gameState.hasTreasure=!0,this.gameState.sceneCompleted=this.gameState.sceneCompleted||{},this.gameState.sceneCompleted.treasureRoom=!0,this.gameState.completedScenes.includes("treasureRoom")||this.gameState.completedScenes.push("treasureRoom"),this.logs.unshift({time:new Date().toLocaleString(),message:"你带着帮手成功取得了宝藏，获得30金币！",type:"success"}),this.saveGame(),{success:!0,message:"获得宝藏"})},searchBooks(){return this.gameState.hasClue?(this.logs.unshift({time:new Date().toLocaleString(),message:"你已经找到了图书馆里的线索。"}),this.saveGame(),{success:!1,message:"已找到线索"}):(this.gameState.hasClue=!0,this.gameState.completedScenes.includes("library")||this.gameState.completedScenes.push("library"),this.logs.unshift({time:new Date().toLocaleString(),message:"你在古籍中找到了前往神庙的线索！"}),this.saveGame(),{success:!0,message:"获得线索"})},addLog(e,s="info"){this.logs.unshift({time:new Date().toLocaleString(),message:e,type:s}),this.saveGame()},completeGame(){return this.gameState.gameCompleted=!0,this.gameState.score=(this.gameState.gold||0)+(this.gameState.completedScenes.length||0)*10,this.addLog("冒险已完成，分数已结算。","success"),this.saveGame(),{success:!0}}}});export{g as u};
